import{k as s,N as e,P as o,L as t,bd as c,I as n,m as a,p as i,q as l,A as k,o as r,s as h,j as d,t as g,b as p,v as m,K as u}from"./index-DQotwNSd.js";import{_ as f}from"./page-head.CAicG8M0.js";import{r as T}from"./uni-app.es.Dfk47BXh.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";let w=s().platform;const C=_({data:()=>({connected:!1,connecting:!1,socketTask:!1,msg:!1}),computed:{showMsg(){return this.connected?this.msg?"收到消息："+this.msg:"等待接收消息":"尚未连接"}},onUnload(){e(),this.socketTask&&this.socketTask.close&&this.socketTask.close()},methods:{connect(){if(this.connected||this.connecting)return o({content:"正在连接或者已经连接，请勿重复连接",showCancel:!1}),!1;this.connecting=!0,t({title:"连接中..."}),this.socketTask=c({url:"wss://echo.websocket.org",data:()=>({msg:"Hello"}),success(s){},fail(s){}}),console.log(this.socketTask),this.socketTask.onOpen((s=>{this.connecting=!1,this.connected=!0,e(),n({icon:"none",title:"连接成功"}),console.log("onOpen",s)})),this.socketTask.onError((s=>{this.connecting=!1,this.connected=!1,e(),o({content:"连接失败，可能是websocket服务不可用，请稍后再试",showCancel:!1}),console.log("onError",s)})),this.socketTask.onMessage((s=>{this.msg=s.data,console.log("onMessage",s)})),this.socketTask.onClose((s=>{this.connected=!1,this.startRecive=!1,this.socketTask=!1,this.msg=!1,console.log("onClose",s)})),console.log("task",this.socketTask)},send(){this.socketTask.send({data:"from "+w+" : "+parseInt(1e4*Math.random()).toString(),success(s){console.log(s)},fail(s){console.log(s)}})},close(){this.socketTask&&this.socketTask.close&&this.socketTask.close()}}},[["render",function(s,e,o,t,c,n){const _=T(a("page-head"),f),w=k,C=u;return r(),i(w,null,{default:l((()=>[h(_,{title:"websocket通讯示例"}),h(w,{class:"uni-padding-wrap"},{default:l((()=>[h(w,{class:"uni-btn-v"},{default:l((()=>[h(w,{class:"websocket-msg"},{default:l((()=>[d(g(n.showMsg),1)])),_:1}),h(C,{type:"primary",onClick:n.connect},{default:l((()=>[d("连接websocket服务")])),_:1},8,["onClick"]),p(h(C,{type:"primary",onClick:n.send},{default:l((()=>[d("发送一条消息")])),_:1},8,["onClick"]),[[m,c.connected]]),h(C,{type:"primary",onClick:n.close},{default:l((()=>[d("断开websocket服务")])),_:1},8,["onClick"]),h(w,{class:"websocket-tips"},{default:l((()=>[d("发送消息后会收到一条服务器返回的消息（与发送的消息内容一致）")])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-c9112632"]]);export{C as default};
