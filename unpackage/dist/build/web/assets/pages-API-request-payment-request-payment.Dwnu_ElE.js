import{az as e,M as t,aA as a,ax as n,P as o,I as i,m as s,p as r,q as l,A as d,o as c,s as p,j as u,y as f,ac as h}from"./index-DQotwNSd.js";import{_ as m}from"./page-head.CAicG8M0.js";import{r as g}from"./uni-app.es.Dfk47BXh.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=w({data:()=>({title:"request-payment",loading:!1,price:1,providerList:[]}),onLoad:function(){},methods:{loginMpWeixin:()=>new Promise(((n,o)=>{e({provider:"weixin",success(e){console.warn("此处使用uni-id处理微信小程序登录，详情参考: https://uniapp.dcloud.net.cn/uniCloud/uni-id"),t({url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/user-center",method:"POST",data:{action:"loginByWeixin",params:{code:e.code,platform:"mp-weixin"}},success(e){0===e.data.code?(a("openid",e.data.openid),n(e.data.openid)):o(new Error("获取openid失败：",e.result.msg))},fail(e){o(new Error("获取openid失败："+e))}})},fail(e){o(e)}})})),async weixinPay(){let e=n("openid");if(console.log("发起支付"),this.loading=!0,!e){try{e=await this.loginMpWeixin()}catch(a){console.error(a)}if(!e)return o({content:"获取openid失败",showCancel:!1}),void(this.loading=!1)}this.openid=e;let t=await this.getOrderInfo("wxpay");t?uni.requestPayment({...t,success:e=>{i({title:"感谢您的赞助!"})},fail:e=>{o({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.loading=!1}}):o({content:"获取支付信息失败",showCancel:!1})},async requestPayment(e,t){this.providerList[t].loading=!0;const a=e.id;let n=await this.getOrderInfo(a);n?(console.log("--------orderInfo--------"),console.log(n),uni.requestPayment({provider:a,orderInfo:n,success:e=>{console.log("success",e),i({title:"感谢您的赞助!"})},fail:e=>{console.log("fail",e),o({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.providerList[t].loading=!1}})):o({content:"获取支付信息失败",showCancel:!1})},getOrderInfo(e){return new Promise(((a,n)=>{this.price||n(new Error("请输入金额")),console.warn("此处使用uni-pay处理支付，详情参考: https://uniapp.dcloud.io/uniCloud/unipay"),t({method:"POST",url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/pay",data:{provider:e,openid:this.openid,totalFee:100*Number(this.price)},success(e){0===e.data.code?a(e.data.orderInfo):n(new Error("获取支付信息失败"+e.data.msg))},fail(e){n(new Error("请求支付接口失败"+e))}})}))},priceChange(e){console.log(e.detail.value),this.price=e.detail.value}}},[["render",function(e,t,a,n,o,i){const w=g(s("page-head"),m),y=f,x=d,v=h;return c(),r(x,null,{default:l((()=>[p(w,{title:o.title},null,8,["title"]),p(x,{class:"uni-padding-wrap"},{default:l((()=>[p(x,{style:{background:"#FFF",padding:"50rpx 0"}},{default:l((()=>[p(x,{class:"uni-hello-text uni-center"},{default:l((()=>[p(y,null,{default:l((()=>[u("支付金额")])),_:1})])),_:1}),p(x,{class:"uni-h1 uni-center uni-common-mt"},{default:l((()=>[p(y,{class:"rmbLogo"},{default:l((()=>[u("￥")])),_:1}),p(v,{class:"price",type:"digit",value:o.price,maxlength:"4",onInput:i.priceChange},null,8,["value","onInput"])])),_:1})])),_:1}),p(x,{class:"uni-btn-v uni-common-mt"})])),_:1})])),_:1})}],["__scopeId","data-v-8fabb4ed"]]);export{y as default};
