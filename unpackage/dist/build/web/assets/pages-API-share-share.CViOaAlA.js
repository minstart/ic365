import{aw as e,P as s,aq as a,m as t,p as i,q as o,A as l,o as n,s as r,j as p,h as c,an as h,x as u}from"./index-DQotwNSd.js";import{_ as m}from"./page-head.CAicG8M0.js";import{r as d}from"./uni-app.es.Dfk47BXh.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const f=g({data:()=>({title:"share",shareText:"uni-app可以同时发布成原生App、小程序、H5，邀请你一起体验！",href:"https://uniapp.dcloud.io",image:"",shareType:1,providerList:[]}),computed:{isDisableButton:()=>function(e){return 0===this.shareType&&"qq"===e.id||5===this.shareType&&"分享到微信好友"!==e.name}},onShareAppMessage(){return{title:this.shareText?this.shareText:"欢迎体验uni-app",path:"/pages/tabBar/component/component",imageUrl:this.image?this.image:"https://web-assets.dcloud.net.cn/unidoc/zh/share-logo@3.png"}},onUnload:function(){this.shareText="uni-app可以同时发布成原生App、小程序、H5，邀请你一起体验！",this.href="https://uniapp.dcloud.io",this.image=""},onLoad:function(){e({service:"share",success:e=>{console.log("success",e);let s=[];for(let a=0;a<e.provider.length;a++)switch(e.provider[a]){case"weixin":s.push({name:"分享到微信好友",id:"weixin",sort:0}),s.push({name:"分享到微信朋友圈",id:"weixin",type:"WXSenceTimeline",sort:1});break;case"sinaweibo":s.push({name:"分享到新浪微博",id:"sinaweibo",sort:2});break;case"qq":s.push({name:"分享到QQ",id:"qq",sort:3})}this.providerList=s.sort(((e,s)=>e.sort-s.sort))},fail:e=>{console.log("获取分享通道失败",e),s({content:"获取分享通道失败",showCancel:!1})}})},methods:{async share(e){if(console.log("分享通道:"+e.id+"； 分享类型:"+this.shareType),!this.shareText&&(1===this.shareType||0===this.shareType))return void s({content:"分享内容不能为空",showCancel:!1});if(!this.image&&(2===this.shareType||0===this.shareType))return void s({content:"分享图片不能为空",showCancel:!1});let a={provider:e.id,scene:e.type&&"WXSceneTimeline"===e.type?"WXSceneTimeline":"WXSceneSession",type:this.shareType,success:e=>{console.log("success",e),s({content:"已分享",showCancel:!1})},fail:e=>{console.log("fail",e),s({content:e.errMsg,showCancel:!1})},complete:function(){console.log("分享操作结束!")}};switch(this.shareType){case 0:a.summary=this.shareText,a.imageUrl=this.image,a.title="欢迎体验uniapp",a.href="https://uniapp.dcloud.io";break;case 1:a.summary=this.shareText;break;case 2:a.imageUrl=this.image;break;case 5:a.imageUrl=this.image?this.image:"https://web-ext-storage.dcloud.net.cn/hello-uni-app/share.png",a.title="欢迎体验uniapp",a.miniProgram={id:"gh_33446d7f7a26",path:"/pages/tabBar/component/component",webUrl:"https://uniapp.dcloud.io",type:0}}0===a.type&&"iOS"===plus.os.name&&(a.imageUrl=await this.compress()),1===a.type&&"qq"===a.provider&&(a.href="https://uniapp.dcloud.io",a.title="欢迎体验uniapp"),uni.share(a)},radioChange(e){console.log("type:"+e.detail.value),this.shareType=parseInt(e.detail.value)},chooseImage(){a({count:1,sourceType:["album","camera"],sizeType:["compressed","original"],success:e=>{this.image=e.tempFilePaths[0]},fail:e=>{}})},compress(){console.log("开始压缩");let e=this.image;return new Promise((a=>{var t=plus.io.convertAbsoluteFileSystem(e.replace("file://",""));console.log("after"+t),plus.io.resolveLocalFileSystemURL(t,(t=>{t.file((t=>{console.log("getFile:"+JSON.stringify(t)),t.size>20480&&plus.zip.compressImage({src:e,dst:e.replace(".jpg","2222.jpg").replace(".JPG","2222.JPG"),width:"10%",height:"10%",quality:1,overwrite:!0},(s=>{console.log("success zip****"+s.size);let t=e.replace(".jpg","2222.jpg").replace(".JPG","2222.JPG");a(t)}),(function(e){s({content:"分享图片太大,需要请重新选择图片!",showCancel:!1})}))}))}),(e=>{console.log("Resolve file URL failed: "+e.message),s({content:"分享图片太大,需要请重新选择图片!",showCancel:!1})}))}))}}},[["render",function(e,s,a,g,f,y){const T=d(t("page-head"),m),w=l,x=h,b=u;return n(),i(w,null,{default:o((()=>[r(T,{title:f.title},null,8,["title"]),r(w,{class:"uni-padding-wrap"},{default:o((()=>[r(w,{class:"uni-title"},{default:o((()=>[p("分享内容")])),_:1}),r(w,{class:"uni-textarea"},{default:o((()=>[r(x,{class:"textarea",modelValue:f.shareText,"onUpdate:modelValue":s[0]||(s[0]=e=>f.shareText=e)},null,8,["modelValue"])])),_:1}),r(w,{class:"uni-title"},{default:o((()=>[p("分享图片：")])),_:1}),r(w,{class:"uni-uploader",style:{padding:"15rpx",background:"#FFF"}},{default:o((()=>[f.image?c("",!0):(n(),i(w,{key:0,class:"uni-uploader__input-box",onClick:y.chooseImage},null,8,["onClick"])),f.image?(n(),i(b,{key:1,class:"uni-uploader__img",src:f.image},null,8,["src"])):c("",!0)])),_:1})])),_:1})])),_:1})}]]);export{f as default};
