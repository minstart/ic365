import{b7 as t,O as e,ba as s,M as i,ax as a,br as o,am as r,P as n,p as c,q as d,A as p,o as l,s as u,j as y,d as h,f,F as g,y as m,t as v,a8 as k}from"./index-DQotwNSd.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";function x(t){this.key=t.key,this.requestConfig={key:t.key,s:"rsx",platform:"WXJS",appname:t.key,sdkversion:"1.2.0",logversion:"2.0"}}x.prototype.getWxLocation=function(i,a){t({type:"gcj02",success:function(t){var s=t.longitude+","+t.latitude;e({key:"userLocation",data:s}),a(s)},fail:function(t){s({key:"userLocation",success:function(t){t.data&&a(t.data)}}),i.fail({errCode:"0",errMsg:t.errMsg||""})}})},x.prototype.getRegeo=function(t){function e(e){var a=s.requestConfig;i({url:"https://restapi.amap.com/v3/geocode/regeo",data:{key:s.key,location:e,extensions:"all",s:a.s,platform:a.platform,appname:s.key,sdkversion:a.sdkversion,logversion:a.logversion},method:"GET",header:{"content-type":"application/json"},success:function(s){var i,a,o,r,n,c,d,p,l;s.data.status&&"1"==s.data.status?(a=(i=s.data.regeocode).addressComponent,o=[],r="",i&&i.roads[0]&&i.roads[0].name&&(r=i.roads[0].name+"附近"),n=e.split(",")[0],c=e.split(",")[1],i.pois&&i.pois[0]&&(r=i.pois[0].name+"附近",(d=i.pois[0].location)&&(n=parseFloat(d.split(",")[0]),c=parseFloat(d.split(",")[1]))),a.provice&&o.push(a.provice),a.city&&o.push(a.city),a.district&&o.push(a.district),a.streetNumber&&a.streetNumber.street&&a.streetNumber.number?(o.push(a.streetNumber.street),o.push(a.streetNumber.number)):(p="",i&&i.roads[0]&&i.roads[0].name&&(p=i.roads[0].name),o.push(p)),o=o.join(""),l=[{iconPath:t.iconPath,width:t.iconWidth,height:t.iconHeight,name:o,desc:r,longitude:n,latitude:c,id:0,regeocodeData:i}],t.success(l)):t.fail({errCode:s.data.infocode,errMsg:s.data.info})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})}var s=this;t.location?e(t.location):s.getWxLocation(t,(function(t){e(t)}))},x.prototype.getWeather=function(t){function e(e){var o="base";t.type&&"forecast"==t.type&&(o="all"),i({url:"https://restapi.amap.com/v3/weather/weatherInfo",data:{key:s.key,city:e,extensions:o,s:a.s,platform:a.platform,appname:s.key,sdkversion:a.sdkversion,logversion:a.logversion},method:"GET",header:{"content-type":"application/json"},success:function(e){var s,i,a;e.data.status&&"1"==e.data.status?e.data.lives?(s=e.data.lives)&&s.length>0&&(s=s[0],(i={city:{text:"城市",data:(a=s).city},weather:{text:"天气",data:a.weather},temperature:{text:"温度",data:a.temperature},winddirection:{text:"风向",data:a.winddirection+"风"},windpower:{text:"风力",data:a.windpower+"级"},humidity:{text:"湿度",data:a.humidity+"%"}}).liveData=s,t.success(i)):e.data.forecasts&&e.data.forecasts[0]&&t.success({forecast:e.data.forecasts[0]}):t.fail({errCode:e.data.infocode,errMsg:e.data.info})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})}var s=this,a=s.requestConfig;t.city?e(t.city):s.getWxLocation(t,(function(o){var r;r=o,i({url:"https://restapi.amap.com/v3/geocode/regeo",data:{key:s.key,location:r,extensions:"all",s:a.s,platform:a.platform,appname:s.key,sdkversion:a.sdkversion,logversion:a.logversion},method:"GET",header:{"content-type":"application/json"},success:function(s){var i,a;s.data.status&&"1"==s.data.status?((a=s.data.regeocode).addressComponent?i=a.addressComponent.adcode:a.aois&&a.aois.length>0&&(i=a.aois[0].adcode),e(i)):t.fail({errCode:s.data.infocode,errMsg:s.data.info})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})}))},x.prototype.getPoiAround=function(t){function e(e){var o={key:s.key,location:e,s:a.s,platform:a.platform,appname:s.key,sdkversion:a.sdkversion,logversion:a.logversion};t.querytypes&&(o.types=t.querytypes),t.querykeywords&&(o.keywords=t.querykeywords),i({url:"https://restapi.amap.com/v3/place/around",data:o,method:"GET",header:{"content-type":"application/json"},success:function(e){var s,i,a,o;if(e.data.status&&"1"==e.data.status){if((e=e.data)&&e.pois){for(s=[],i=0;i<e.pois.length;i++)a=0==i?t.iconPathSelected:t.iconPath,s.push({latitude:parseFloat(e.pois[i].location.split(",")[1]),longitude:parseFloat(e.pois[i].location.split(",")[0]),iconPath:a,width:22,height:32,id:i,name:e.pois[i].name,address:e.pois[i].address});o={markers:s,poisData:e.pois},t.success(o)}}else t.fail({errCode:e.data.infocode,errMsg:e.data.info})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})}var s=this,a=s.requestConfig;t.location?e(t.location):s.getWxLocation(t,(function(t){e(t)}))},x.prototype.getStaticmap=function(t){function e(e){a.push("location="+e),t.zoom&&a.push("zoom="+t.zoom),t.size&&a.push("size="+t.size),t.scale&&a.push("scale="+t.scale),t.markers&&a.push("markers="+t.markers),t.labels&&a.push("labels="+t.labels),t.paths&&a.push("paths="+t.paths),t.traffic&&a.push("traffic="+t.traffic);var s=o+a.join("&");t.success({url:s})}var s,i=this,a=[],o="https://restapi.amap.com/v3/staticmap?";a.push("key="+i.key),s=i.requestConfig,a.push("s="+s.s),a.push("platform="+s.platform),a.push("appname="+s.appname),a.push("sdkversion="+s.sdkversion),a.push("logversion="+s.logversion),t.location?e(t.location):i.getWxLocation(t,(function(t){e(t)}))},x.prototype.getInputtips=function(t){var e=this,s=e.requestConfig,a={key:e.key,s:s.s,platform:s.platform,appname:e.key,sdkversion:s.sdkversion,logversion:s.logversion};t.location&&(a.location=t.location),t.keywords&&(a.keywords=t.keywords),t.type&&(a.type=t.type),t.city&&(a.city=t.city),t.citylimit&&(a.citylimit=t.citylimit),i({url:"https://restapi.amap.com/v3/assistant/inputtips",data:a,method:"GET",header:{"content-type":"application/json"},success:function(e){e&&e.data&&e.data.tips&&t.success({tips:e.data.tips})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})},x.prototype.getDrivingRoute=function(t){var e=this,s=e.requestConfig,a={key:e.key,s:s.s,platform:s.platform,appname:e.key,sdkversion:s.sdkversion,logversion:s.logversion};t.origin&&(a.origin=t.origin),t.destination&&(a.destination=t.destination),t.strategy&&(a.strategy=t.strategy),t.waypoints&&(a.waypoints=t.waypoints),t.avoidpolygons&&(a.avoidpolygons=t.avoidpolygons),t.avoidroad&&(a.avoidroad=t.avoidroad),i({url:"https://restapi.amap.com/v3/direction/driving",data:a,method:"GET",header:{"content-type":"application/json"},success:function(e){e&&e.data&&e.data.route&&t.success({paths:e.data.route.paths,taxi_cost:e.data.route.taxi_cost||""})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})},x.prototype.getWalkingRoute=function(t){var e=this,s=e.requestConfig,a={key:e.key,s:s.s,platform:s.platform,appname:e.key,sdkversion:s.sdkversion,logversion:s.logversion};t.origin&&(a.origin=t.origin),t.destination&&(a.destination=t.destination),i({url:"https://restapi.amap.com/v3/direction/walking",data:a,method:"GET",header:{"content-type":"application/json"},success:function(e){e&&e.data&&e.data.route&&t.success({paths:e.data.route.paths})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})},x.prototype.getTransitRoute=function(t){var e=this,s=e.requestConfig,a={key:e.key,s:s.s,platform:s.platform,appname:e.key,sdkversion:s.sdkversion,logversion:s.logversion};t.origin&&(a.origin=t.origin),t.destination&&(a.destination=t.destination),t.strategy&&(a.strategy=t.strategy),t.city&&(a.city=t.city),t.cityd&&(a.cityd=t.cityd),i({url:"https://restapi.amap.com/v3/direction/transit/integrated",data:a,method:"GET",header:{"content-type":"application/json"},success:function(e){if(e&&e.data&&e.data.route){var s=e.data.route;t.success({distance:s.distance||"",taxi_cost:s.taxi_cost||"",transits:s.transits})}},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})},x.prototype.getRidingRoute=function(t){var e=this,s=e.requestConfig,a={key:e.key,s:s.s,platform:s.platform,appname:e.key,sdkversion:s.sdkversion,logversion:s.logversion};t.origin&&(a.origin=t.origin),t.destination&&(a.destination=t.destination),i({url:"https://restapi.amap.com/v4/direction/bicycling",data:a,method:"GET",header:{"content-type":"application/json"},success:function(e){e&&e.data&&e.data.data&&t.success({paths:e.data.data.paths})},fail:function(e){t.fail({errCode:"0",errMsg:e.errMsg||""})}})};const w={AMapWX:x},b={"1号线":"#C43B33","2号线":"#016299","4号线/大兴线":"#008E9C","5号线":"#A42380","6号线":"#D09900","7号线":"#F2C172","8号线":"#009D6A","9号线":"#8FC41E","10号线":"#009DBE","13号线":"#F9E701","14号线东段":"#D4A7A2","14号线西段":"#D4A7A2","15号线":"#5D2D69","八通线":"#C33A32","昌平线":"#DE82B1","亦庄线":"#E40177","房山线":"#E66021","机场线":"#A29BBC"},M=[{id:"150500",icon:"icon-ditie"},{id:"150700",icon:"icon-gongjiao"},{id:"190700",icon:"icon-gonglu"}],L={key:"b526b09b86cd2996e7732be8ab8c4430",mapInit(){return new w.AMapWX({key:this.key})},typecode:M,lineColor:t=>b[t]?b[t]:"#ccc",serachNmme(t,e){let s=new RegExp(t);return`<div style="font-size: 14px;color: #333;line-height: 1.5;">\n\t\t    ${e.replace(s,"<span style='color:#66ccff;'>"+t+"</span>")}\n\t\t    </div>`.trim()},addressToLine(t,e){let s=t.split(";"),i="";return s.forEach((t=>{let s="#cccccc";e===M[0].id?s=this.lineColor(t):e===M[1].id&&(s="#4075cb"),i+=`<div style='${"margin:5px 0;margin-right:5px;padding:0 5px;background:"+s+";font-size:12px;color:#fff;border-radius:3px;"}'>${t}</div>`})),`<div style="display:flex;flex-wrap: wrap;">${i}</div>`},dataHandle:(t,e)=>(t.nameNodes=e?L.serachNmme(e,t.name):`<div style="font-size: 14px;color: #333;line-height: 1.5;">${t.name}</div>`,t.typecode===L.typecode[0].id||t.typecode===L.typecode[1].id?(t.addressNodes=L.addressToLine(t.address,t.typecode),t.typecode===L.typecode[0].id?t.icon=L.typecode[0].icon:t.typecode===L.typecode[1].id&&(t.icon=L.typecode[1].icon)):(t.addressNodes=`<span>${t.district}${t.address.length>0?"·"+t.address:""}</span>`.trim(),t.icon="icon-weizhi"),t.location&&0===t.location.length&&(t.icon="icon-sousuo"),t),setHistory(t){let s=a("search:history");s||(s=[]);let i={};i="string"==typeof t?{adcode:[],address:[],city:[],district:[],id:[],location:[],name:t,typecode:[]}:t;for(var o=0;o<s.length;o++)if(s[o].name===i.name){s.splice(o,1);break}s.unshift(L.dataHandle(i)),e({key:"search:history",data:s,success:function(){}})},getHistory(){},removeHistory:()=>(o({key:"search:history",success:function(t){console.log("success")}}),[])};const _=C({data:()=>({historyList:[],isHistory:!0,list:[],flng:!0,timer:null}),onLoad(){this.amapPlugin=L.mapInit(),this.historyList=a("search:history")},methods:{listTap(t){t=JSON.parse(JSON.stringify(t)),this.history||(this.isHistory=!0,L.setHistory(t),r())},clearSearch(){n({title:"提示",content:"是否清理全部搜索历史？该操作不可逆。",success:t=>{t.confirm&&(this.historyList=L.removeHistory())}})},getInputtips(t){let e=this;this.amapPlugin.getInputtips({keywords:t,city:"北京",success:s=>{let i=s.tips;i.map((e=>L.dataHandle(e,t))),e.historyList=i},fail:t=>{console.log(t)}})}},onNavigationBarSearchInputChanged(t){let e=t.text;if(!e)return this.isHistory=!0,this.historyList=[],void(this.historyList=a("search:history"));this.isHistory=!1,this.getInputtips(e)},onNavigationBarSearchInputConfirmed(t){let e=t.text;if(!e)return this.isHistory=!0,this.historyList=[],this.historyList=a("search:history"),void n({title:"提示",content:"请输入内容。",success:t=>{t.confirm}});n({title:"提示",content:`您输入的内容为"${e}",如果点击确定,将记录到历史搜索,并返回.如果取消不做操作`,success:t=>{t.confirm&&(L.setHistory(e),r())}})},onNavigationBarButtonTap(){n({title:"提示",content:"点击确定，修改输入框的内容为abc",success:t=>{if(t.confirm){this.$mp.page.$getAppWebview().setTitleNViewSearchInputText("abc")}}})}},[["render",function(t,e,s,i,a,o){const r=m,n=p,C=k;return l(),c(n,{class:"wrapper"},{default:d((()=>[a.isHistory?(l(),c(n,{key:0,class:"history-box"},{default:d((()=>[a.historyList.length>0?(l(),c(n,{key:0},{default:d((()=>[u(n,{class:"history-title"},{default:d((()=>[u(r,null,{default:d((()=>[y("搜索历史")])),_:1}),u(r,{class:"uni-icon uni-icon-trash",onClick:o.clearSearch},null,8,["onClick"])])),_:1}),u(n,{class:"history-content"},{default:d((()=>[(l(!0),h(g,null,f(a.historyList,((t,e)=>(l(),c(n,{class:"history-item",key:e},{default:d((()=>[y(v(t.name),1)])),_:2},1024)))),128))])),_:1})])),_:1})):(l(),c(n,{key:1,class:"no-data"},{default:d((()=>[y("您还没有历史记录")])),_:1}))])),_:1})):(l(),c(n,{key:1,class:"history-box"},{default:d((()=>[a.historyList.length>0?(l(),c(n,{key:0,class:"history-list-box"},{default:d((()=>[(l(!0),h(g,null,f(a.historyList,((t,e)=>(l(),c(n,{class:"history-list-item",key:e,onClick:e=>o.listTap(t)},{default:d((()=>[u(C,{nodes:t.nameNodes},null,8,["nodes"])])),_:2},1032,["onClick"])))),128))])),_:1})):(l(),c(n,{key:1,class:"no-data"},{default:d((()=>[y("没有搜索到相关内容")])),_:1}))])),_:1}))])),_:1})}],["__scopeId","data-v-314c7d35"]]);export{_ as default};
