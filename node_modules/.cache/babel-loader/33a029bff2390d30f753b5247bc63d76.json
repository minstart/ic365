{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\后台\\src\\utils\\cryptoService.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\后台\\src\\utils\\cryptoService.js","mtime":1752486893179},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\babel.config.js","mtime":1592918105000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvXHU1NDBFXHU1M0YwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvci5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvXHU1NDBFXHU1M0YwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IHsgZ2VuZXJhdGVBZXNLZXksIHJzYUVuY3J5cHQgfSBmcm9tICcuL2NyeXB0byc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKdmFyIFJTQVVybCA9ICJodHRwczovL2ljMzY1YWRtLmFqdWx5ZS5jb20iOwoKLy8g5a+G6ZKl5Lqk5o2i6YC76L6R77yI55m75b2V5pe25L2/55So77yJCmV4cG9ydCBmdW5jdGlvbiBleGNoYW5nZUtleXMoKSB7CiAgcmV0dXJuIF9leGNoYW5nZUtleXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQpmdW5jdGlvbiBfZXhjaGFuZ2VLZXlzKCkgewogIF9leGNoYW5nZUtleXMgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yKCkubShmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgdmFyIHB1YlJlcywgYWVzS2V5LCBlbmNyeXB0ZWRLZXksIGtleVJlcywgY3J5cHRvRGF0YSwgX3Q7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yKCkudyhmdW5jdGlvbiAoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQubikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIF9jb250ZXh0LnAgPSAwOwogICAgICAgICAgX2NvbnRleHQubiA9IDE7CiAgICAgICAgICByZXR1cm4gcmVxdWVzdCh7CiAgICAgICAgICAgIHVybDogUlNBVXJsICsgJy9hZG1pbi9jcnlwdG8vcHVibGljS2V5JywKICAgICAgICAgICAgbWV0aG9kOiAnZ2V0JwogICAgICAgICAgfSk7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcHViUmVzID0gX2NvbnRleHQudjsKICAgICAgICAgIC8vIDIuIOeUn+aIkOW5tuWKoOWvhkFFU+WvhumSpQogICAgICAgICAgYWVzS2V5ID0gZ2VuZXJhdGVBZXNLZXkoKTsKICAgICAgICAgIGVuY3J5cHRlZEtleSA9IHJzYUVuY3J5cHQoYWVzS2V5LCBwdWJSZXMuZGF0YS5wdWJsaWNfa2V5KTsgLy8gMy4g5Lqk5o2i5a+G6ZKlCiAgICAgICAgICBfY29udGV4dC5uID0gMjsKICAgICAgICAgIHJldHVybiByZXF1ZXN0KHsKICAgICAgICAgICAgdXJsOiBSU0FVcmwgKyAnL2FkbWluL2NyeXB0by9leGNoYW5nZScsCiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICBrZXlJZDogcHViUmVzLmRhdGEua2V5X2lkLAogICAgICAgICAgICAgIGVuY3J5cHRlZEFlc0tleTogZW5jcnlwdGVkS2V5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGtleVJlcyA9IF9jb250ZXh0LnY7CiAgICAgICAgICAvLyA0LiDlrZjlgqjlr4bpkqXkv6Hmga8KICAgICAgICAgIGNyeXB0b0RhdGEgPSB7CiAgICAgICAgICAgIHNlc3Npb25LZXk6IGtleVJlcy5kYXRhLnNlc3Npb25fa2V5LAogICAgICAgICAgICBhZXNLZXk6IGFlc0tleSwKICAgICAgICAgICAgZXhwaXJlVGltZTogRGF0ZS5ub3coKSArIGtleVJlcy5kYXRhLmV4cGlyZV90aW1lICogMTAwMAogICAgICAgICAgfTsKICAgICAgICAgIGNvbnNvbGUubG9nKERhdGUubm93KCkpOwogICAgICAgICAgY29uc29sZS5sb2coRGF0ZS5ub3coKSArIGtleVJlcy5kYXRhLmV4cGlyZV90aW1lICogMTAwMCk7CiAgICAgICAgICBzdG9yZS5jb21taXQoJ3VzZXIvU0VUX0NSWVBUTycsIGNyeXB0b0RhdGEpOwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmEoMiwgY3J5cHRvRGF0YSk7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgX2NvbnRleHQucCA9IDM7CiAgICAgICAgICBfdCA9IF9jb250ZXh0LnY7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCflr4bpkqXkuqTmjaLlpLHotKUnLCBfdCk7CiAgICAgICAgICB0aHJvdyBfdDsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYSgyKTsKICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1swLCAzXV0pOwogIH0pKTsKICByZXR1cm4gX2V4Y2hhbmdlS2V5cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CnZhciByZWZyZXNoUHJvbWlzZSA9IG51bGw7CmV4cG9ydCBmdW5jdGlvbiByZWZyZXNoS2V5cygpIHsKICByZXR1cm4gX3JlZnJlc2hLZXlzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCi8vIOajgOafpeWvhumSpeaYr+WQpuacieaViO+8iOaPkOWJjTEw56eS5Yi35paw77yJCmZ1bmN0aW9uIF9yZWZyZXNoS2V5cygpIHsKICBfcmVmcmVzaEtleXMgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yKCkubShmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgIHJldHVybiBfcmVnZW5lcmF0b3IoKS53KGZ1bmN0aW9uIChfY29udGV4dDMpIHsKICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQzLm4pIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBpZiAoIXJlZnJlc2hQcm9taXNlKSB7CiAgICAgICAgICAgIF9jb250ZXh0My5uID0gMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmEoMiwgcmVmcmVzaFByb21pc2UpOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJlZnJlc2hQcm9taXNlID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvcigpLm0oZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IoKS53KGZ1bmN0aW9uIChfY29udGV4dDIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIubikgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBfY29udGV4dDIucCA9IDA7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uID0gMTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4Y2hhbmdlS2V5cygpOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmEoMiwgX2NvbnRleHQyLnYpOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICBfY29udGV4dDIucCA9IDI7CiAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcm9taXNlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5mKDIpOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmEoMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1swLCwgMiwgM11dKTsKICAgICAgICAgIH0pKSgpOwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hKDIsIHJlZnJlc2hQcm9taXNlKTsKICAgICAgfQogICAgfSwgX2NhbGxlZTMpOwogIH0pKTsKICByZXR1cm4gX3JlZnJlc2hLZXlzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KZXhwb3J0IGZ1bmN0aW9uIHNob3VsZFJlZnJlc2hLZXlzKGNyeXB0bykgewogIHJldHVybiAhY3J5cHRvIHx8ICFjcnlwdG8uc2Vzc2lvbktleSB8fCAhY3J5cHRvLmFlc0tleSB8fCBjcnlwdG8uZXhwaXJlVGltZSAtIERhdGUubm93KCkgPCAxMDAwMDsKfQ=="},{"version":3,"names":["request","generateAesKey","rsaEncrypt","store","RSAUrl","exchangeKeys","_exchangeKeys","apply","arguments","_asyncToGenerator","_regenerator","m","_callee","pubRes","aesKey","encryptedKey","keyRes","cryptoData","_t","w","_context","n","p","url","method","v","data","public_key","params","keyId","key_id","encryptedAesKey","sessionKey","session_key","expireTime","Date","now","expire_time","console","log","commit","a","error","refreshPromise","refreshKeys","_refreshKeys","_callee3","_context3","_callee2","_context2","f","shouldRefreshKeys","crypto"],"sources":["C:/Users/Administrator/Desktop/后台/src/utils/cryptoService.js"],"sourcesContent":["import request from '@/utils/request'\nimport { generateAesKey, rsaEncrypt } from './crypto'\nimport store from '@/store'\n\r\nconst RSAUrl = \"https://ic365adm.ajulye.com\"\r\n\n// 密钥交换逻辑（登录时使用）\nexport async function exchangeKeys() {\n  try {\n    // 1. 获取RSA公钥\n    const pubRes = await request({ url: RSAUrl + '/admin/crypto/publicKey', method: 'get' })\n\n    // 2. 生成并加密AES密钥\n    const aesKey = generateAesKey()\n    const encryptedKey = rsaEncrypt(aesKey, pubRes.data.public_key)\n\n    // 3. 交换密钥\n    const keyRes = await request({\n      url: RSAUrl + '/admin/crypto/exchange',\n      method: 'post',\n      params: {\n        keyId: pubRes.data.key_id,\n        encryptedAesKey: encryptedKey\n      }\n    })\n\n    // 4. 存储密钥信息\n    const cryptoData = {\n      sessionKey: keyRes.data.session_key,\n      aesKey: aesKey,\n      expireTime: Date.now() + keyRes.data.expire_time * 1000\n    }\n\n    console.log(Date.now())\n    console.log(Date.now() + keyRes.data.expire_time * 1000)\n\n    store.commit('user/SET_CRYPTO', cryptoData)\n\n    return cryptoData\n  } catch (error) {\n    console.error('密钥交换失败', error)\n    throw error\n  }\n}\n\nlet refreshPromise = null\n\nexport async function refreshKeys() {\n  if (refreshPromise) {\n    return refreshPromise\n  }\n\n  refreshPromise = (async () => {\n    try {\n      return await exchangeKeys()\n    } finally {\n      refreshPromise = null\n    }\n  })()\n\n  return refreshPromise\n}\n\n// 检查密钥是否有效（提前10秒刷新）\nexport function shouldRefreshKeys(crypto) {\n  return !crypto ||\n    !crypto.sessionKey ||\n    !crypto.aesKey ||\n    (crypto.expireTime - Date.now() < 10000)\n}\n"],"mappings":"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","ignoreList":[]}]}