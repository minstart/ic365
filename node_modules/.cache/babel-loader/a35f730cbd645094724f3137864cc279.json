{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\后台\\src\\utils\\cryptoService.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\后台\\src\\utils\\cryptoService.js","mtime":1752287103250},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\babel.config.js","mtime":1592918105000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvXHU1NDBFXHU1M0YwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvci5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvXHU1NDBFXHU1M0YwL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IHsgZ2VuZXJhdGVBZXNLZXksIHJzYUVuY3J5cHQgfSBmcm9tICcuL2NyeXB0byc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKCi8vIOWvhumSpeS6pOaNoumAu+i+ke+8iOeZu+W9leaXtuS9v+eUqO+8iQpleHBvcnQgZnVuY3Rpb24gZXhjaGFuZ2VLZXlzKCkgewogIHJldHVybiBfZXhjaGFuZ2VLZXlzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KZnVuY3Rpb24gX2V4Y2hhbmdlS2V5cygpIHsKICBfZXhjaGFuZ2VLZXlzID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvcigpLm0oZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgIHZhciBwdWJSZXMsIGFlc0tleSwgZW5jcnlwdGVkS2V5LCBrZXlSZXMsIGNyeXB0b0RhdGEsIF90OwogICAgcmV0dXJuIF9yZWdlbmVyYXRvcigpLncoZnVuY3Rpb24gKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Lm4pIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBfY29udGV4dC5wID0gMDsKICAgICAgICAgIF9jb250ZXh0Lm4gPSAxOwogICAgICAgICAgcmV0dXJuIHJlcXVlc3QoewogICAgICAgICAgICB1cmw6ICcvY3J5cHRvL3B1YmxpY0tleScsCiAgICAgICAgICAgIG1ldGhvZDogJ2dldCcKICAgICAgICAgIH0pOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHB1YlJlcyA9IF9jb250ZXh0LnY7CiAgICAgICAgICAvLyAyLiDnlJ/miJDlubbliqDlr4ZBRVPlr4bpkqUKICAgICAgICAgIGFlc0tleSA9IGdlbmVyYXRlQWVzS2V5KCk7CiAgICAgICAgICBlbmNyeXB0ZWRLZXkgPSByc2FFbmNyeXB0KGFlc0tleSwgcHViUmVzLmRhdGEucHVibGljX2tleSk7IC8vIDMuIOS6pOaNouWvhumSpQogICAgICAgICAgX2NvbnRleHQubiA9IDI7CiAgICAgICAgICByZXR1cm4gcmVxdWVzdCh7CiAgICAgICAgICAgIHVybDogJy9jcnlwdG8vZXhjaGFuZ2UnLAogICAgICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAga2V5SWQ6IHB1YlJlcy5kYXRhLmtleV9pZCwKICAgICAgICAgICAgICBlbmNyeXB0ZWRBZXNLZXk6IGVuY3J5cHRlZEtleQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBrZXlSZXMgPSBfY29udGV4dC52OwogICAgICAgICAgLy8gNC4g5a2Y5YKo5a+G6ZKl5L+h5oGvCiAgICAgICAgICBjcnlwdG9EYXRhID0gewogICAgICAgICAgICBzZXNzaW9uS2V5OiBrZXlSZXMuZGF0YS5zZXNzaW9uX2tleSwKICAgICAgICAgICAgYWVzS2V5OiBhZXNLZXksCiAgICAgICAgICAgIGV4cGlyZVRpbWU6IERhdGUubm93KCkgKyBrZXlSZXMuZGF0YS5leHBpcmVfdGltZSAqIDEwMDAKICAgICAgICAgIH07CiAgICAgICAgICBjb25zb2xlLmxvZyhEYXRlLm5vdygpKTsKICAgICAgICAgIGNvbnNvbGUubG9nKERhdGUubm93KCkgKyBrZXlSZXMuZGF0YS5leHBpcmVfdGltZSAqIDEwMDApOwogICAgICAgICAgc3RvcmUuY29tbWl0KCd1c2VyL1NFVF9DUllQVE8nLCBjcnlwdG9EYXRhKTsKICAgICAgICAgIHJldHVybiBfY29udGV4dC5hKDIsIGNyeXB0b0RhdGEpOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIF9jb250ZXh0LnAgPSAzOwogICAgICAgICAgX3QgPSBfY29udGV4dC52OwogICAgICAgICAgY29uc29sZS5lcnJvcign5a+G6ZKl5Lqk5o2i5aSx6LSlJywgX3QpOwogICAgICAgICAgdGhyb3cgX3Q7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmEoMik7CiAgICAgIH0KICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMCwgM11dKTsKICB9KSk7CiAgcmV0dXJuIF9leGNoYW5nZUtleXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQp2YXIgcmVmcmVzaFByb21pc2UgPSBudWxsOwpleHBvcnQgZnVuY3Rpb24gcmVmcmVzaEtleXMoKSB7CiAgcmV0dXJuIF9yZWZyZXNoS2V5cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgovLyDmo4Dmn6Xlr4bpkqXmmK/lkKbmnInmlYjvvIjmj5DliY0xMOenkuWIt+aWsO+8iQpmdW5jdGlvbiBfcmVmcmVzaEtleXMoKSB7CiAgX3JlZnJlc2hLZXlzID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvcigpLm0oZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yKCkudyhmdW5jdGlvbiAoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0My5uKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgaWYgKCFyZWZyZXNoUHJvbWlzZSkgewogICAgICAgICAgICBfY29udGV4dDMubiA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hKDIsIHJlZnJlc2hQcm9taXNlKTsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZWZyZXNoUHJvbWlzZSA9IF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3IoKS5tKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yKCkudyhmdW5jdGlvbiAoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLm4pIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLnAgPSAwOwogICAgICAgICAgICAgICAgICBfY29udGV4dDIubiA9IDE7CiAgICAgICAgICAgICAgICAgIHJldHVybiBleGNoYW5nZUtleXMoKTsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hKDIsIF9jb250ZXh0Mi52KTsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLnAgPSAyOwogICAgICAgICAgICAgICAgICByZWZyZXNoUHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuZigyKTsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hKDIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbMCwsIDIsIDNdXSk7CiAgICAgICAgICB9KSkoKTsKICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYSgyLCByZWZyZXNoUHJvbWlzZSk7CiAgICAgIH0KICAgIH0sIF9jYWxsZWUzKTsKICB9KSk7CiAgcmV0dXJuIF9yZWZyZXNoS2V5cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CmV4cG9ydCBmdW5jdGlvbiBzaG91bGRSZWZyZXNoS2V5cyhjcnlwdG8pIHsKICByZXR1cm4gIWNyeXB0byB8fCAhY3J5cHRvLnNlc3Npb25LZXkgfHwgIWNyeXB0by5hZXNLZXkgfHwgY3J5cHRvLmV4cGlyZVRpbWUgLSBEYXRlLm5vdygpIDwgMTAwMDA7Cn0="},{"version":3,"names":["request","generateAesKey","rsaEncrypt","store","exchangeKeys","_exchangeKeys","apply","arguments","_asyncToGenerator","_regenerator","m","_callee","pubRes","aesKey","encryptedKey","keyRes","cryptoData","_t","w","_context","n","p","url","method","v","data","public_key","params","keyId","key_id","encryptedAesKey","sessionKey","session_key","expireTime","Date","now","expire_time","console","log","commit","a","error","refreshPromise","refreshKeys","_refreshKeys","_callee3","_context3","_callee2","_context2","f","shouldRefreshKeys","crypto"],"sources":["C:/Users/Administrator/Desktop/后台/src/utils/cryptoService.js"],"sourcesContent":["import request from '@/utils/request'\nimport { generateAesKey, rsaEncrypt } from './crypto'\nimport store from '@/store'\n\n// 密钥交换逻辑（登录时使用）\nexport async function exchangeKeys() {\n  try {\n    // 1. 获取RSA公钥\n    const pubRes = await request({ url: '/crypto/publicKey', method: 'get' })\n\n    // 2. 生成并加密AES密钥\n    const aesKey = generateAesKey()\n    const encryptedKey = rsaEncrypt(aesKey, pubRes.data.public_key)\n\n    // 3. 交换密钥\n    const keyRes = await request({\n      url: '/crypto/exchange',\n      method: 'post',\n      params: {\n        keyId: pubRes.data.key_id,\n        encryptedAesKey: encryptedKey\n      }\n    })\n\n    // 4. 存储密钥信息\n    const cryptoData = {\n      sessionKey: keyRes.data.session_key,\n      aesKey: aesKey,\n      expireTime: Date.now() + keyRes.data.expire_time * 1000\n    }\n\n    console.log(Date.now())\n    console.log(Date.now() + keyRes.data.expire_time * 1000)\n\n    store.commit('user/SET_CRYPTO', cryptoData)\n\n    return cryptoData\n  } catch (error) {\n    console.error('密钥交换失败', error)\n    throw error\n  }\n}\n\nlet refreshPromise = null\n\nexport async function refreshKeys() {\n  if (refreshPromise) {\n    return refreshPromise\n  }\n\n  refreshPromise = (async () => {\n    try {\n      return await exchangeKeys()\n    } finally {\n      refreshPromise = null\n    }\n  })()\n\n  return refreshPromise\n}\n\n// 检查密钥是否有效（提前10秒刷新）\nexport function shouldRefreshKeys(crypto) {\n  return !crypto ||\n    !crypto.sessionKey ||\n    !crypto.aesKey ||\n    (crypto.expireTime - Date.now() < 10000)\n}\n"],"mappings":"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","ignoreList":[]}]}