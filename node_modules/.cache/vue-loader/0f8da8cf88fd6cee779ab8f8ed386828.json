{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\后台\\src\\views\\question\\edit.vue?vue&type=style&index=0&id=7f048969&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\后台\\src\\views\\question\\edit.vue","mtime":1752293339480},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\后台\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5lZGl0LWNhcmQgewogIGJvcmRlci1yYWRpdXM6IDhweDsKICBtYXJnaW46IDIwcHg7Cn0KCi5oZWFkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBtYXJnaW4tYm90dG9tOiAzMHB4OwogIHBhZGRpbmctYm90dG9tOiAxNXB4OwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWJlZWY1Owp9CgouaGVhZGVyIC50aXRsZSB7CiAgbWFyZ2luLWxlZnQ6IDIwcHg7CiAgZm9udC1zaXplOiAyMHB4OwogIGNvbG9yOiAjMzAzMTMzOwp9CgouZm9ybS1mb290ZXIgewogIG1hcmdpbi10b3A6IDMwcHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgouZWwtZm9ybS1pdGVtIHsKICBtYXJnaW4tYm90dG9tOiAyMnB4Owp9CgouZWwtZGl2aWRlciB7CiAgbWFyZ2luOiAzMHB4IDA7Cn0K"},{"version":3,"sources":["edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4WA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"edit.vue","sourceRoot":"src/views/question","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-card shadow=\"never\" class=\"edit-card\">\n      <div class=\"header\">\n        <el-button type=\"text\" icon=\"el-icon-arrow-left\" @click=\"goBack\">返回列表</el-button>\n        <h2 class=\"title\">{{ pageTitle }}</h2>\n      </div>\n\n      <el-form ref=\"form\" :model=\"formData\" label-width=\"120px\" label-position=\"top\">\n        <el-row :gutter=\"20\">\n          <el-col :span=\"24\">\n            <el-form-item label=\"题目ID\" prop=\"questionId\">\n              <el-input\n                v-model=\"formData.questionId\"\n                :disabled=\"isEditMode\"\n                :placeholder=\"isEditMode ? '' : '请输入题目ID'\"\n              />\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"12\">\n            <el-form-item label=\"标题\" prop=\"title\" required>\n              <el-input v-model=\"formData.title\" placeholder=\"请输入题目标题\" />\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"6\">\n            <el-form-item label=\"类型\" prop=\"typeText\" required>\n              <el-select v-model=\"formData.typeText\" placeholder=\"请选择类型\">\n                <el-option label=\"选择题\" value=\"选择题\" />\n                <el-option label=\"填空题\" value=\"填空题\" />\n                <el-option label=\"判断题\" value=\"判断题\" />\n                <el-option label=\"主观题\" value=\"主观题\" />\n              </el-select>\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"6\">\n            <el-form-item label=\"状态\" prop=\"statusText\" required>\n              <el-select v-model=\"formData.statusText\" placeholder=\"请选择状态\">\n                <el-option label=\"启用\" value=\"启用\" />\n                <el-option label=\"禁用\" value=\"禁用\" />\n              </el-select>\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"6\">\n            <el-form-item label=\"年级\" prop=\"gradeText\" required>\n              <el-select\n                v-model=\"formData.gradeText\"\n                placeholder=\"请选择年级\"\n                @change=\"handleGradeChange\"\n              >\n                <el-option\n                  v-for=\"g in grades\"\n                  :key=\"g.value\"\n                  :label=\"g.label\"\n                  :value=\"g.value\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"6\">\n            <el-form-item label=\"学期\" prop=\"semester\" required>\n              <el-select\n                v-model=\"formData.semester\"\n                placeholder=\"请选择学期\"\n                @change=\"handleSemesterChange\"\n              >\n                <el-option label=\"无\" value=\"none\" />\n                <el-option label=\"上学期\" value=\"fall\" />\n                <el-option label=\"下学期\" value=\"spring\" />\n              </el-select>\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"12\">\n            <el-form-item label=\"分类\" prop=\"categoryId\" required>\n              <el-select\n                v-model=\"formData.categoryId\"\n                placeholder=\"请先选择年级和学期\"\n                :loading=\"categoryLoading\"\n                filterable\n                clearable\n              >\n                <el-option\n                  v-for=\"c in categories\"\n                  :key=\"c.categoryId\"\n                  :label=\"c.name\"\n                  :value=\"c.categoryId\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n\n          <!-- 题目内容 -->\n          <el-col :span=\"24\">\n            <el-form-item label=\"题目内容\" prop=\"content\" required>\n              <el-input\n                v-model=\"formData.content\"\n                type=\"textarea\"\n                :rows=\"4\"\n                placeholder=\"请输入题目内容\"\n              />\n            </el-form-item>\n          </el-col>\n\n          <!-- 关联题目内容（只读） -->\n          <el-col :span=\"24\">\n            <el-form-item label=\"关联题目内容\" prop=\"topicContent\">\n              <el-input\n                :value=\"formData.topicContent\"\n                type=\"textarea\"\n                :rows=\"4\"\n                placeholder=\"关联题目内容\"\n                disabled\n              />\n            </el-form-item>\n          </el-col>\n\n          <!-- 题目答案 -->\n          <el-col :span=\"24\">\n            <el-form-item label=\"题目答案\" prop=\"answer\" required>\n              <el-input\n                v-model=\"formData.answer\"\n                type=\"textarea\"\n                :rows=\"3\"\n                placeholder=\"请输入题目答案\"\n              />\n            </el-form-item>\n          </el-col>\n\n          <!-- 关联题目答案（只读） -->\n          <el-col :span=\"24\">\n            <el-form-item label=\"关联题目答案\" prop=\"topicAnswer\">\n              <el-input\n                :value=\"formData.topicAnswer\"\n                type=\"textarea\"\n                :rows=\"3\"\n                placeholder=\"关联题目答案\"\n                disabled\n              />\n            </el-form-item>\n          </el-col>\n\n          <!-- 题目解析 -->\n          <el-col :span=\"24\">\n            <el-form-item label=\"题目解析\" prop=\"analysis\" required>\n              <el-input\n                v-model=\"formData.analysis\"\n                type=\"textarea\"\n                :rows=\"4\"\n                placeholder=\"请输入题目解析\"\n              />\n            </el-form-item>\n          </el-col>\n\n          <!-- 关联题目解析（只读） -->\n          <el-col :span=\"24\">\n            <el-form-item label=\"关联题目解析\" prop=\"topicAnalysis\">\n              <el-input\n                :value=\"formData.topicAnalysis\"\n                type=\"textarea\"\n                :rows=\"4\"\n                placeholder=\"关联题目解析\"\n                disabled\n              />\n            </el-form-item>\n          </el-col>\n\n          <el-col :span=\"24\">\n            <el-form-item label=\"选项内容\" prop=\"options\">\n              <el-input\n                v-model=\"formData.options\"\n                type=\"textarea\"\n                :rows=\"3\"\n                placeholder=\"请输入选项内容（选择题需要）\"\n              />\n            </el-form-item>\n          </el-col>\n        </el-row>\n\n        <div class=\"form-footer\">\n          <el-button\n            type=\"primary\"\n            :loading=\"loading\"\n            @click=\"submitForm\"\n          >\n            {{ isEditMode ? '保存修改' : '创建题目' }}\n          </el-button>\n          <el-button @click=\"resetForm\">重置</el-button>\n        </div>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { getQuestionDetail, updateQuestion, createQuestion } from '@/api/question'\nimport { getByGradeAndSemester } from '@/api/category'\n\nexport default {\n  name: 'QuestionEdit',\n  data() {\n    return {\n      loading: false,\n      categoryLoading: false,\n      formData: {\n        questionId: '',\n        title: '',\n        content: '',\n        answer: '',\n        analysis: '',\n        topicContent: '',  // 只读，不提交\n        topicAnswer: '',   // 只读，不提交\n        topicAnalysis: '', // 只读，不提交\n        typeText: '',\n        createTime: '',\n        categoryId: null,  // 修改为categoryId\n        statusText: '',\n        gradeText: '',\n        semester: 'none',\n        options: ''\n      },\n      grades: [\n        { value: '1', label: '1年级' },\n        { value: '2', label: '2年级' },\n        { value: '3', label: '3年级' },\n        { value: '4', label: '4年级' },\n        { value: '5', label: '5年级' },\n        { value: '6', label: '6年级' }\n      ],\n      categories: [],\n      originalData: {},\n      id: null,\n      isEditMode: true\n    }\n  },\n  computed: {\n    pageTitle() {\n      if (this.isEditMode) {\n        return `题目编辑 - ${this.formData.title || '新题目'}`\n      }\n      return '新增题目'\n    }\n  },\n  created() {\n    this.id = this.$route.params.question_id || this.$route.query.question_id\n    this.isEditMode = !!this.id\n\n    if (!this.isEditMode) {\n      // 新增模式，初始化空表单\n      this.originalData = { ...this.formData }\n      return\n    }\n\n    this.fetchData()\n  },\n  methods: {\n    fetchData() {\n      this.loading = true\n      getQuestionDetail(this.id).then(response => {\n        this.formData = response.data\n\n        // 处理年级格式\n        if (this.formData.gradeText) {\n          const gradeValue = this.formData.gradeText.replace('年级', '')\n          this.formData.gradeText = gradeValue\n        }\n\n        // 确保分类ID正确\n        if (this.formData.categoryName) {\n          // 如果后端返回的是分类名称，需要转换为ID\n          // 这里假设后端返回了分类ID\n          this.formData.categoryId = this.formData.categoryId || null\n        }\n\n        // 如果有分类信息，尝试加载对应的分类\n        if (this.formData.gradeText && this.formData.semester) {\n          this.loadCategories(this.formData.gradeText, this.formData.semester)\n        }\n\n        this.originalData = { ...this.formData }\n      }).catch(error => {\n        console.error('获取题目详情失败:', error)\n        this.$message.error('获取题目详情失败: ' + (error.message || '未知错误'))\n      }).finally(() => {\n        this.loading = false\n      })\n    },\n\n    handleGradeChange(grade) {\n      if (this.formData.semester && this.formData.semester !== 'none') {\n        this.loadCategories(grade, this.formData.semester)\n      }\n    },\n\n    handleSemesterChange(semester) {\n      // 学期改变时重置分类选择\n      this.formData.categoryId = null\n      this.categories = []\n\n      if (this.formData.gradeText && semester !== 'none') {\n        this.loadCategories(this.formData.gradeText, semester)\n      }\n    },\n\n    loadCategories(grade, semester) {\n      this.categoryLoading = true\n      getByGradeAndSemester(parseInt(grade), semester)\n        .then(response => {\n          this.categories = response.data\n          if (this.categories.length === 0) {\n            this.$message.info('该年级和学期下没有找到分类')\n          }\n        })\n        .catch(error => {\n          console.error('获取分类失败:', error)\n          this.$message.error('获取分类失败: ' + (error.message || '未知错误'))\n        })\n        .finally(() => {\n          this.categoryLoading = false\n        })\n    },\n\n    submitForm() {\n      // 在提交前转换年级格式\n      const formDataCopy = { ...this.formData }\n      formDataCopy.gradeText = formDataCopy.gradeText + '年级'\n\n      // 移除不需要提交的字段\n      const { topicContent, topicAnswer, topicAnalysis, ...submitData } = formDataCopy\n\n      this.loading = true\n\n      const action = this.isEditMode\n        ? updateQuestion(this.formData.questionId, submitData)\n        : createQuestion(submitData)\n\n      action.then(() => {\n        this.$message.success(this.isEditMode ? '题目更新成功' : '题目创建成功')\n        this.goBack()\n      }).catch(error => {\n        console.error('操作失败:', error)\n        this.$message.error(`${this.isEditMode ? '更新' : '创建'}题目失败: ${error.message || '未知错误'}`)\n      }).finally(() => {\n        this.loading = false\n      })\n    },\n\n    resetForm() {\n      this.formData = { ...this.originalData }\n      this.$message.info('已重置为原始数据')\n    },\n\n    goBack() {\n      this.$router.push('/question/list')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.edit-card {\n  border-radius: 8px;\n  margin: 20px;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 30px;\n  padding-bottom: 15px;\n  border-bottom: 1px solid #ebeef5;\n}\n\n.header .title {\n  margin-left: 20px;\n  font-size: 20px;\n  color: #303133;\n}\n\n.form-footer {\n  margin-top: 30px;\n  text-align: center;\n}\n\n.el-form-item {\n  margin-bottom: 22px;\n}\n\n.el-divider {\n  margin: 30px 0;\n}\n</style>\n"]}]}